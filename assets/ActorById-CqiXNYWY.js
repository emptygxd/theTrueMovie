import{j as s,p as b,n as S,q as $,L as m,R as j,d as y,e as P,b as h,r as d,h as _,c as w}from"./index-pTCheAQo.js";import{A as x}from"./AboutBlock-HyJ84n3Z.js";function E(e){return e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():""}const F=e=>{const r=e.toLocaleDateString("ru-RU",{day:"numeric",month:"long"}),t=e.getFullYear();return`${r}, ${t}`},L=e=>e?`${(e/100).toFixed(2)} м`:" ",R=e=>{const r=e%10,t=e%100;return t>=11&&t<=19?`${e} детей`:r===1?`${e} ребёнок`:r>=2&&r<=4?`${e} ребёнка`:`${e} детей`},I=e=>{const r=new Set;return e.forEach(t=>{t.enProfession&&r.add(t.enProfession)}),Array.from(r)},O={actor:"Актёр",producer:"Продюсер",director:"Режиссёр",writer:"Сценарист",cameo:"Камео",uncredited:"Не указан в титрах"},q=e=>O[e]||e,A=({person:e})=>s.jsx("div",{className:"facts__wrapper",children:s.jsxs("div",{className:"content__plot facts",children:[s.jsx("h2",{className:"section-header",children:"Знали ли вы, что..."}),s.jsx("div",{className:"facts__container",children:e.facts.map((r,t)=>s.jsx("p",{className:"person__age-separator facts__item",children:b(r.value)},t))})]})}),D=({person:e,spouses:r})=>s.jsxs("div",{className:"person__header",children:[s.jsx("img",{src:e.photo??S,alt:"photo",className:"person__poster"}),s.jsxs("div",{className:"person__info-container",children:[s.jsxs("div",{className:"person__name",children:[s.jsx("h1",{children:e.name}),s.jsx("h4",{className:"person__en-name",children:e.enName})]}),s.jsxs("div",{className:"person__info",children:[s.jsx("h2",{className:"section-header",children:"О человеке"}),s.jsxs("div",{className:"movie__about",children:[s.jsx("p",{className:"movie__about-title",children:"Дата рождения"}),s.jsx("p",{className:`movie__about-value person__age${e.birthday?"":" about__no-info"}`,children:e.birthday&&s.jsxs(s.Fragment,{children:[F(new Date(e.birthday)),s.jsx("span",{className:"person__age-separator"}),s.jsx("span",{className:"subtle-text",children:$(e.age??0)})]})})]}),s.jsxs("div",{className:"movie__about",children:[s.jsx("p",{className:"movie__about-title",children:"Место рождения"}),s.jsx("p",{className:`movie__about-value-arr${e.birthPlace[0]?"":" about__no-info"}`,children:e.birthPlace.map((t,i)=>i===e.birthPlace.length-1?s.jsx(m,{to:"/movies",children:t.value},i):`${t.value}, `)})]}),e.spouses[0]&&s.jsxs("div",{className:"movie__about",children:[s.jsx("p",{className:"movie__about-title",children:E(e.spouses[0].relation)}),s.jsx("div",{className:"person__spouses-container",children:e.spouses.map((t,i)=>s.jsxs("p",{className:"movie__about-value-arr person__spouses",children:[r[i]!==""&&s.jsx(m,{to:`${j.PERSONS}/${t.id}`,children:r[i]}),r[i]===""&&s.jsx("p",{children:"?"}),t.divorced?`(${t.divorcedReason})`:"",s.jsx("span",{className:"subtle-text",children:R(t.children)})]},i))})]}),s.jsx(x,{title:"Рост",value:L(e.growth)}),s.jsx(x,{title:"Всего фильмов",value:e.movies.length})]})]})]}),k=({movies:e,tabClickHandler:r,selectedTab:t})=>{const i=I(e),a=i.map(q);return s.jsxs("div",{className:"person__movies",children:[s.jsx("div",{className:"tabs",children:i.map((n,o)=>s.jsx("button",{className:`tab ${t===n?"active":""}`,onClick:()=>r(n),children:a[o]},n))}),s.jsx("div",{className:"tab__content",children:e.filter(n=>n.enProfession===t).map((n,o)=>s.jsx(m,{to:`${j.MOVIES}/${n.id}`,children:s.jsxs("div",{className:"tab__item",children:[s.jsxs("div",{className:"tab__item-name",children:[s.jsx("h4",{children:n.name??n.alternativeName}),n.name&&s.jsx("p",{children:n.alternativeName})]}),s.jsx("div",{className:"tab__item-rating",children:s.jsx(y,{rating:n.rating??0})})]})},o))})]})},B=()=>{const{personId:e}=P(),{isLoading:r,isError:t,data:i}=h({queryKey:["person",e],queryFn:()=>_.get(`/person/${e}`),select:c=>c.data,refetchOnWindowFocus:!1}),a=i;d.useEffect(()=>{a&&(console.log(a.name),document.title=a.name??a.enName)},[a]),localStorage.setItem("person",JSON.stringify(a));const{isLoading:n,isError:o,data:f}=h({queryKey:["spouse",a==null?void 0:a.spouses],queryFn:async()=>{var c;return((c=a==null?void 0:a.spouses)==null?void 0:c.length)>0?(await Promise.allSettled(a.spouses.map(l=>_.get(`/person/${l.id}`).then(g=>g.data.name)))).map(l=>l.status==="fulfilled"?l.value:""):[]},enabled:!!(a!=null&&a.spouses),refetchOnWindowFocus:!1}),u=f||[];localStorage.setItem("spouses",JSON.stringify(u));const[p,v]=d.useState((a==null?void 0:a.movies[0].enProfession)??"actor"),N=d.useCallback(c=>{v(c)},[]);return r||n?s.jsx(w,{}):t||o?s.jsxs("div",{children:["Error: ",t??o]}):s.jsx(s.Fragment,{children:s.jsxs("section",{className:"person",children:[s.jsx(D,{person:a,spouses:u}),a.facts[0]&&s.jsx(A,{person:a}),s.jsx(k,{movies:a.movies,tabClickHandler:N,selectedTab:p})]})})};export{B as default};
